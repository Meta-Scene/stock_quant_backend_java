<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>股票数据分析平台</title>
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <div id="app">
    <el-container>
      <el-header>
        <h1>股票数据分析平台</h1>
      </el-header>

      <el-main>
        <el-row :gutter="20">
          <el-col :span="24">
            <el-card>
              <template #header>
                <div class="clearfix">
                  <span>数据筛选</span>
                </div>
              </template>
              <el-form :inline="true" :model="searchForm" class="demo-form-inline">
                <el-form-item label="股票代码">
                  <el-input v-model="searchForm.ts_code" placeholder="股票代码"></el-input>
                </el-form-item>
                <el-form-item label="日期">
                  <el-date-picker v-model="searchForm.trade_date" type="date" placeholder="选择日期" format="YYYY-MM-DD"
                    value-format="YYYY-MM-DD"></el-date-picker>
                </el-form-item>
                <el-form-item>
                  <el-button type="primary" @click="loadAllData">查询全部数据</el-button>
                  <el-button type="success" @click="loadLimitUpData">查询涨停数据</el-button>
                  <el-button type="danger" @click="loadLimitDownData">查询跌停数据</el-button>
                  <el-button type="warning" @click="loadHalfYearLineData">查询半年线数据（±1年）</el-button>
                  <el-button type="info" @click="loadYearLineData">查询年线数据（±3年）</el-button>
                  <el-button type="primary" @click="loadOutperformData">查询强于大盘数据</el-button>
                  <el-button type="danger" @click="loadUnderperformData">查询弱于大盘数据</el-button>
                  <el-button type="warning" @click="loadFiveDayAdjustmentData" plain>查询五日调整分析</el-button>
                </el-form-item>
              </el-form>
            </el-card>
          </el-col>
        </el-row>

        <el-row :gutter="20" style="margin-top: 20px;" v-if="stockResponse">
          <el-col :span="24">
            <el-card>
              <template #header>
                <div class="clearfix">
                  <span>数据概览</span>
                  <span style="float: right">
                    查询日期: {{ stockResponse.date }}
                    | 股票数量: {{ stockResponse.stock_count }}
                    <span v-if="currentDataType === 'fiveDayAdjustment'"> | 买点数量: {{ stockResponse.buy_signals_count
                      }}</span>
                    | 当前页: {{ stockResponse.page }}
                  </span>
                </div>
              </template>

              <div class="pagination-container">
                <el-pagination @current-change="handlePageChange" :current-page="stockResponse.page"
                  :page-size="stockResponse.grid_data ? stockResponse.grid_data.length : 0"
                  :total="stockResponse.stock_count" layout="total, prev, pager, next">
                </el-pagination>
              </div>

              <el-alert type="info" show-icon :closable="false" title="提示：图表支持缩放和滚动查看"
                description="在图表区域滚动鼠标滚轮或使用下方滑块可查看全部日期数据。双击图表可还原视图。" style="margin-bottom: 15px;">
              </el-alert>

              <el-alert v-if="currentDataType === 'halfYearLine'" type="warning" show-icon :closable="false"
                title="半年线数据说明" description="显示的是选定日期前后一年的数据（约250个交易日），可通过缩放查看完整数据。" style="margin-bottom: 15px;">
              </el-alert>

              <el-alert v-if="currentDataType === 'yearLine'" type="info" show-icon :closable="false" title="年线数据说明"
                description="显示的是选定日期前后三年的数据（约750个交易日），可通过缩放查看完整数据。" style="margin-bottom: 15px;">
              </el-alert>

              <el-alert v-if="currentDataType === 'outperform'" type="success" show-icon :closable="false"
                title="强于大盘数据说明" description="显示的是斜率大于大盘斜率的股票数据。鼠标移动到图表上会显示当天的斜率值。斜率表示股价的每日变化百分比，用于调试分析。"
                style="margin-bottom: 15px;">
              </el-alert>

              <el-alert v-if="currentDataType === 'underperform'" type="warning" show-icon :closable="false"
                title="弱于大盘数据说明" description="显示的是斜率小于大盘斜率的股票数据。鼠标移动到图表上会显示当天的斜率值。斜率表示股价的每日变化百分比，用于调试分析。"
                style="margin-bottom: 15px;">
              </el-alert>

              <el-alert v-if="currentDataType === 'fiveDayAdjustment'" type="success" show-icon :closable="false"
                title="五日调整分析数据说明"
                description="显示的是当日bay值大于0（有买点）的股票数据，共有 {{stockResponse.buy_signals_count}} 只股票出现买点信号。数据显示了选定日期前后20个交易日的价格走势。"
                style="margin-bottom: 15px;">
              </el-alert>

              <el-tabs v-model="activeTab" type="card">
                <el-tab-pane v-for="(stockData, index) in stockResponse.grid_data" :key="index"
                  :label="getStockLabelByIndex(index)" :name="index">
                  <div class="stock-info">
                    <h3>{{ getStockLabelByIndex(index) }}</h3>

                    <!-- 股票价格走势图 -->
                    <div class="chart-container" :id="'chart-' + index"></div>

                    <!-- 当前交易日斜率信息 -->
                    <div v-if="currentDataType === 'outperform' || currentDataType === 'underperform'"
                      class="slope-info">
                      <el-tag type="info" size="large" style="margin-top: 20px;">
                        {{ getTargetDateSlope(index) }}
                      </el-tag>
                    </div>

                    <!-- 五日调整分析买点信息 -->
                    <div v-if="currentDataType === 'fiveDayAdjustment'" class="buy-signal-info">
                      <el-tag type="success" size="large" style="margin-top: 20px;">
                        {{ stockResponse.date }} 有买点信号
                      </el-tag>
                    </div>
                  </div>
                </el-tab-pane>
              </el-tabs>
            </el-card>
          </el-col>
        </el-row>

        <el-row :gutter="20" style="margin-top: 20px;" v-if="!stockResponse">
          <el-col :span="24">
            <el-empty description="暂无数据，请选择查询条件"></el-empty>
          </el-col>
        </el-row>
      </el-main>

      <el-footer>
        <p>&copy; 2024 股票数据分析平台 - 版权所有</p>
      </el-footer>
    </el-container>
  </div>

  <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
  <script src="https://unpkg.com/element-plus"></script>
  <script src="https://unpkg.com/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="js/app.js?v=20240624"></script>
</body>

</html>